<div class="rooms-container">
    <div class="rooms-content">
        <div class="rooms-list">
            <h2>Rooms</h2>
            <div class="room-grid">
                <div class="room-card" *ngFor="let room of rooms">
                    <img *ngIf="room.roomType?.imageName" class="room-image"
                        [src]="'assets/room-types/' + room.roomType?.imageName"
                        [alt]="room.roomType?.name || 'Room Type'">
                    <div class="room-details">
                        <strong>#{{ room.roomNumber }}</strong>
                        <div>{{ room.type }} | {{ room.capacity }} guests | ${{ room.price }}</div>
                        <div>
                            <span [class.available]="room.available" [class.unavailable]="!room.available">
                                {{ room.available ? 'Available' : 'Unavailable' }}
                            </span>
                        </div>
                        <div class="room-amenities">
                            <small>
                                Amenities:
                                <span *ngIf="room.amenitiesSet?.length; else noAmenities">
                                    <span *ngFor="let amenity of room.amenitiesSet; let last = last">
                                        {{ amenity.name }}<span *ngIf="!last">, </span>
                                    </span>
                                </span>
                                <ng-template #noAmenities>None</ng-template>
                            </small>
                        </div>
                    </div>
                    <div class="room-actions">
                        <ng-container *ngIf="isAdmin; else userActions">
                            <button (click)="selectRoom(room)">Edit</button>
                            <button (click)="deleteRoom(room.id!)">Delete</button>
                        </ng-container>
                        <ng-template #userActions>
                            <button (click)="reserveRoom(room)">Reserve</button>
                        </ng-template>
                    </div>
                </div>
            </div>
        </div>
        <div class="room-form" *ngIf="isAdmin || selectedRoom">
            <h3 *ngIf="!selectedRoom">Add Room</h3>
            <h3 *ngIf="selectedRoom">Edit Room</h3>
            <form *ngIf="!selectedRoom && isAdmin" (ngSubmit)="createRoom()">
                <input id="roomNumber" [(ngModel)]="newRoom.roomNumber" name="roomNumber" placeholder="Room Number"
                    required>

                <select id="roomTypeId" [(ngModel)]="newRoom.roomTypeId" name="roomTypeId"
                    (change)="onRoomTypeChange($event)" required>
                    <option value="" disabled selected>Select Room Type</option>
                    <option *ngFor="let rt of roomTypes" [value]="rt.id">{{ rt.name }}</option>
                </select>

                <input id="capacity" [(ngModel)]="newRoom.capacity" name="capacity" type="number" min="1"
                    placeholder="Capacity" required>

                <input id="price" [(ngModel)]="newRoom.price" name="price" type="number" step="0.01" placeholder="Price"
                    required>

                <div>
                    <input [(ngModel)]="newRoom.available" name="available" type="checkbox" id="available">
                    <label for="available">Available</label>
                </div>

                <select id="amenityIds" multiple [(ngModel)]="newRoom.amenityIds" name="amenityIds">
                    <option value="" disabled>Select Amenities</option>
                    <option *ngFor="let amenity of amenities" [value]="amenity.id">{{ amenity.name }}</option>
                </select>

                <button type="submit">Add</button>
            </form>
            <form *ngIf="selectedRoom" (ngSubmit)="updateRoom()">
                <input [(ngModel)]="selectedRoom.roomNumber" name="editRoomNumber" placeholder="Room Number" required>
                <select [(ngModel)]="selectedRoom.roomTypeId" name="editRoomTypeId"
                    (change)="onEditRoomTypeChange($event)" required>
                    <option value="" disabled>Select Room Type</option>
                    <option *ngFor="let rt of roomTypes" [value]="rt.id">{{ rt.name }}</option>
                </select>
                <input [(ngModel)]="selectedRoom.capacity" name="editCapacity" type="number" min="1"
                    placeholder="Capacity" required>
                <input [(ngModel)]="selectedRoom.price" name="editPrice" type="number" step="0.01" placeholder="Price"
                    required>
                <div>
                    <input [(ngModel)]="selectedRoom.available" name="editAvailable" type="checkbox" id="editAvailable">
                    <label for="editAvailable">Available</label>
                </div>
                <select multiple [(ngModel)]="selectedRoom.amenityIds" name="editAmenityIds">
                    <option value="" disabled>Select Amenities</option>
                    <option *ngFor="let amenity of amenities" [value]="amenity.id">{{ amenity.name }}</option>
                </select>
                <button type="submit">Update</button>
                <button type="button" (click)="selectedRoom = null">Cancel</button>
            </form>
        </div>
    </div>
</div>